---
title: "Coursework 2"
subtitle: "Data Analysis of the 2019 UK General Election Candidate Results"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 1
---

```{r setup, echo = FALSE, message = FALSE , warning = FALSE}
library("here")
library("tidyverse")
library("lubridate")
library("XML")
library("gapminder")
library("ggrepel")
library("gridExtra")
library("kableExtra")
library("janitor")
library("leaflet")
library("ggmap")
library("RColorBrewer")
library("scales")

knitr::opts_chunk$set(
  comment    = "",
  results    = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.show   = "hold"
)
```

# Introduction

This report analyses the 2019 UK House of Commons General Election candidate results. This data set breaks down the results received by each candidate, as well as information about the candidate and the consistency they were standing for election in. The report will propose five questions to query the dataset. Then, an analysis in the R programming language will be carried out, delivering answers to those questions, supported by plots of data.

This data is worth studying by a range of people with a range of use cases for the data in mind. For example:
    - Political Parties who are trying to understand the results of the election to identify possible marginal seats to target with increased efforts.
    - Campaigners looking to achieve an intersectionally representative parliament.
    - Vote Reform Activists identifying parties that are under-represented in parliament and lobbying them to support vote reform, or identifying poorly represented areas to demonstrate the problems with a First-Past-the-Post election system.

# Data

The data set analysed in this report is the [House of Commons General Election 2019 candidate results](http://researchbriefings.files.parliament.uk/documents/CBP-8749/HoC-GE2019-results-by-candidate-csv.csv) (data set source), which was distributed as a CSV file to support the ["General Election 2019: full results and analysis"](https://commonslibrary.parliament.uk/research-briefings/cbp-8749/) briefing paper published by the Commons Library, analysing the result of the 2019 General Election. 

```{r data_set_import}
# IMPORT CANDIDATE RESULTS
# Read Data File into a tibble
raw_cand_results_19 <- read_csv(file = here("data", "HoC-GE2019-results-by-candidate-csv.csv"))
```

## Outline of tidying completed

The data set provided by the Commons Library was already clean and tidy to a high standard. This meant only a 

  - Remove ons_id and ons_region_id as they appear to correspond to constituency_name and region_name and therefore not useful in our analysis.
  - Tidy to correct data types. Most columns can be factors (none ordered)
  - The variables sitting_mp and former_mp can both be converted from Yes and No to boolean TRUE/ FALSE values
  - The Labour Party has a electoral agreement with the Co-operative Party, and while they are a separate legal party in the eyes of the Electoral Commission, in parliament all of its MPs sit in the Parliamentary Labour Party. Therefore, the Labour and Co-operative and Labour party will be merged in this analysis.
  - Then, all other parties other than the main parties will be grouped together in Other. These are parties that secured less votes than the SDLP. The Brexit Party did not win any seats but received the 6th largest share of votes. The Speaker won their seat but does not stand for any party. This common practice (of grouping smaller parties into Other) simplifies the analysis carried out and will reduce clutter on plots. The main parties include:
    - Conservatives,
    - Labour,
    - Liberal Democrats,
    - Scottish National Party,
    - Green Party,
    - Brexit Party
    - Democratic Unionist Party,
    - Sinn Fein,
    - Plaid Cymru,
    - Alliance, and
    - Social Democratic and Labour Party.
  - The parties; Scottish National Party, Democratic Unionist Party, and Social Democratic and Labour Party; were shortened to SNP, DUP, and SDLP, respectively. This was to help make labels in plots more consistent and smaller in size.
  - Added a new column `won` that shows if the candidate won the constituency.


```{r data_set_tidy}
cand_results_19 <- raw_cand_results_19 %>% 
  select(-ons_id, -ons_region_id) %>% 
  mutate_at(vars(constituency_name, county_name, region_name, country_name,
                  constituency_type, party_name, gender), as.factor) %>% 
  mutate(sitting_mp = case_when(
    sitting_mp == "Yes" ~ TRUE,
    sitting_mp == "No" ~ FALSE
  )) %>% 
  mutate(former_mp = case_when(
    former_mp == "Yes" ~ TRUE,
    former_mp == "No" ~ FALSE
  ))

cand_results_19$party_name <- cand_results_19$party_name %>% 
  fct_collapse(Labour = c("Labour", "Labour and Co-operative")) %>% 
  fct_other(keep = c(
    "Conservative", 
    "Labour", 
    "Liberal Democrat", 
    "Scottish National Party",
    "Green", 
    "Brexit Party",
    "Democratic Unionist Party", 
    "Sinn Fein", 
    "Plaid Cymru", 
    "Alliance",  
    "Social Democratic and Labour Party"
  )) %>% 
  fct_recode(
    SNP = "Scottish National Party",
    DUP = "Democratic Unionist Party",
    SDLP = "Social Democratic and Labour Party"
  )

cand_results_19 <- cand_results_19 %>%
  group_by(constituency_name) %>% 
  mutate(won = max(votes) == votes)
```

## Overview of tidied dataset

The tidied dataset contains `r dim(cand_results_19)[1]` observations of `r dim(cand_results_19)[2]` variables. These variables are:

  * county_name: the name of the county the constituency is located in.
  * region_name: the name of the region the constituency is located in.
  * country_name: the name of the relevant country of the UK the constituency was located in.
  * constituency_type : the type of constituency; Borough or County.
  * party_name: the name of the party the candidate was standing in, if a main party. If a smaller party, this value is ‘Other’.
  * party_abbreviation : the abbreviation of the party name.
  * firstname: The first name of the candidate.
  * surname: The surname of the candidate.
  * gender: The gender of the candidate; Male, Female, or NonBinary.
  sitting_mp: If the candidate is the incumbent MP the constituency.
  * former_mp: If the candidate has been previously an MP.
  * votes: The number valid votes were cast for this candidate.
  * share: The share of the total votes cast in the constituency were cast for the candidate.
  * change: The change in share from the candidate of that party to stand in the constituency in the last General Election. NA if none from that party stood.
  * won: If the candidate won the constituency.

No rows/observations were excluded from the dataset.

# Questions

1. Which parties are over represented in parliament and which parties are under represented in each country of the UK?
    - Operationalised - Compare the seat share of each party compared to the vote share of each party?


2. Which counties are best represented in parliament and which counties are the worst represented?
    - Operationalised - What are the top and bottom 10 counties in terms of the mean difference between seat share and vote share?


3. For each of the parties that won seats, what proportion of their MPs are female?
    - Operationalised - Compare the proportion of female MPs for each party.

4. For each main party*, how does the proportion of female candidates standing compare with the proportion of (total party) votes those female candidates received?
    - Operationalised - Compare the proportion of female candidate for each main party with the share of the vote for the party that were cast for female candidates.


5. For candidates from the main parties, win or lose, do incumbent MPs receive more votes on average than non-incumbent challengers?
    - Operationalised - Compare the average vote share of the four categories of main party candidates:
      1. Candidates that won their seat and were sitting MPs;
      2. Candidates that lost their seat and were sitting MPs;
      3. Candidates that won their seat and were not sitting MPs; and
      4. Candidates that lost their seat and were not sitting MPs.

# Analysis

```{r create_plot_colour_scale}
party_names <- cand_results_19 %>% 
  pull(party_name) %>% 
  levels()

party_colours <- c(
  "#F6CB2F",
  "#12B6CF",
  "#0087DC",
  "#D46A4C",
  "#6AB023",
  "#E4003B",
  "#FAA61A",
  "#008142",
  "black", # SNP is Yellow and Black. Yellow was not visible so Black was used.
  "#326760",
  "2AA82C",
  "grey"
)
names(party_colours) <- party_names

# This will allow plots that use the party names as a colour scale to be
# consistent.

party_colour_scale <- 
  scale_colour_manual(
    values = party_colours,
    labels = party_names,
    breaks = party_names,
    name = "Party"
  )
```


## Question 1: By country, which parties are over represented in parliament and which parties are under represented in each country of the UK?

```{r question_1_analysis}
question_1_df <- cand_results_19 %>% 
  group_by(country_name) %>% 
  mutate(
    country_seats = sum(won),
    country_votes = sum(votes)
  ) %>% 
  group_by(party_name, .add = TRUE) %>%
  summarise(
    no_candidates = n(),
    total_votes = sum(votes),
    total_vote_share = round(total_votes / country_votes, 5),
    total_seats = sum(won),
    total_seat_share = round(sum(won) / country_seats, 5)
  ) %>%
  distinct() %>%
  arrange(country_name, desc(total_votes))
```

Looking at the results below, we can see the parties vote and seat share plotted for each country in the UK. The diagonal dotted line is where vote share is the same as seat share, and therefore any party sitting close or on this line are well-represented. Above the line, a party is over-represented in parliament. Below the line, the party is under-represented.

In England; the Conservatives are notably over-represented, Labour are well-represented with roughly the same share of seats as votes, and the other parties are under-represented, the Lib Dems notably so.

In Northern Island, the DUP and Sinn Fein have a disproportionally high number of seats for their vote share, while parties like the SDLP and Alliance are clearly under-represented. There are some smaller parties included in the Other category that are also under-represented.

In Scotland, the SNP is massively over-represented with more than 80% of the seat with only ~50% of the votes. This results in all other parties being under-represented. 

Finally, in Wales, Labour is over-represented, the Conservatives and Plaid Cymru are well-represented, and the Brexit Party and Lib Dems receiving no seats.

This shows that under the current system, people may not be adequately represented by their MPs and some areas might not be better represented than others. The next question looks into this, finding the best and worst represented counties.


```{r question_1_plot}
question_1_df %>% 
  ggplot(
    mapping = aes(
      y = total_seat_share, 
      x = total_vote_share, 
      colour = party_name
    )
  ) +
  geom_point(
    size = 2,
    shape = 3,
    stroke = 1.5
  ) +
  facet_wrap(
    facet = vars(country_name),
    shrink = FALSE
  ) +
  party_colour_scale +
  labs(x = "Vote Share (%)", y = "Seat Share (%)") +
  scale_x_continuous(labels = percent_format(accuracy = 1)) +
  scale_y_continuous(labels = percent_format()) +
  geom_abline(aes(intercept = 0, slope = 1), size = 0.5, linetype = "dashed") +
  annotate(
    geom = "text",
    x = 0.1,
    y = 0.50,
    label = "Over-represented",
    size = 3.5
  ) +
  annotate(
    geom = "text",
    y = 0.04,
    x = 0.35,
    label = "Under-represented",
    size = 3.5 
  )
```


## Question 2: Which counties are best represented in parliament and which counties are the worst represented?

```{r question_2_analysis}
question_2_df <- cand_results_19 %>% 
  group_by(county_name) %>% 
  mutate(total_county_votes = sum(votes)) %>% 
  filter(won == TRUE, .preserve = TRUE) %>% 
  summarise(winning_cand_vote_share = sum(votes)/total_county_votes) %>% 
  distinct() %>% 
  arrange(desc(winning_cand_vote_share))

top_10 <- question_2_df %>% 
  ungroup(county_name) %>% 
  slice_head(n = 10) %>% 
  mutate(top_bottom = "Most Represented Counties")

bottom_10 <- question_2_df %>% 
  ungroup(county_name) %>% 
  slice_tail(n = 10) %>% 
  mutate(top_bottom = "Least Represented Counties")

q2_top_bottom_10 <- bind_rows(top_10, bottom_10)

mean_representation = round(mean(question_2_df$winning_cand_vote_share) * 100, digits = 1)
fivenum_representation = round(fivenum(question_2_df$winning_cand_vote_share) * 100, digits = 1)
IQR_representation = round(IQR(question_2_df$winning_cand_vote_share) * 100, digits = 1)
```

The first plot gives us an overview of the state of representation for the counties in the UK General Election. Overall, the majority of counties have the majority of their voters represented by an MP in that county, with the mean representation being `r mean_representation`. 

While this is not a perfect measure of representation in the UK, as voters are only represented by their direct MP not any MP in the county, it does provide an overview.

```{r question_2_plot_a}
question_2_df %>%
  ggplot(
    mapping = aes(
      x = winning_cand_vote_share
    )
  ) +
  geom_boxplot() +
  geom_rug() +
  scale_x_continuous(
    labels = percent_format(accuracy = 1),
    breaks = seq(from = 0.4, to = 0.7, by = 0.02)
  ) +
  labs(x = "Share of Votes Cast in County for Winning Candidates")
```

The second plot shows us the most and least represented counties in the UK (Scotland and Northern Island were grouped into one county in the source CSV). Lincolnshire, Merseyside, and Essex are some of the best-represented counties in the UK with a representation level of over 60%. On the other end, Gwynedd, Dyfed, and Northern Ireland are some of the worst represented counties in the UK. 

Further investigation could look into the vote turn out of counties and compare that to how well they are represented.

```{r question_2_plot_b}
q2_top_bottom_10 %>% ggplot(
    mapping = aes(
      x = winning_cand_vote_share,
      y = reorder(county_name, winning_cand_vote_share),
      fill = top_bottom
    )
  ) + 
  geom_bar(stat = "identity") +
  scale_x_continuous(
    labels = percent_format(accuracy = 1), 
    limits = c(0,0.70)
  ) +
  labs(
    x = "Share of Votes Cast in County for Winning Candidates",
    y = "Counties"
  ) + 
  scale_colour_discrete() +
  theme(legend.position = "none") +
  facet_wrap(
    facets = vars(top_bottom), 
    nrow = 2, 
    ncol = 1,
    scales = "free_y",
    as.table = FALSE
  )
```

```{r question_2_plot_c}
# bottom_10 %>% ggplot(
#     mapping = aes(
#       x = winning_cand_vote_share,
#       y = reorder(county_name, winning_cand_vote_share),
#       fill = winning_cand_vote_share
#     )
#   ) + 
#   geom_bar(stat = "identity") +
#   scale_x_continuous(
#     labels = percent_format(accuracy = 1),
#     limits = c(0, 0.70)
#   ) +
#   labs(
#     x = "Share of Votes Cast in County for Winning Candidates",
#     y = "Least Represented Counties"
#   ) + 
#   scale_colour_viridis_b() +
#   theme(legend.position = "none")
```

## Question 3: For each of the parties that won seats, what proportion of their MPs are female??

```{r question_3_analysis}
question_3_df <- cand_results_19 %>% 
  group_by(party_name) %>% 
  mutate(party_mps = sum(won)) %>% 
  group_by(gender, .add = TRUE) %>% 
  summarise(
    no_mps = sum(won),
    prop_mps = no_mps / party_mps,
    `Total Party MPs` = party_mps
  ) %>% 
  distinct() %>% 
  filter(gender == "Female") %>% drop_na()
```

A notable piece of news from the 2019 General Election was that ["a record number of women had been elected MPs"](https://www.theguardian.com/politics/2019/dec/13/uk-elects-record-number-of-female-mps). The graph below shows each parties proportion of female MPs and can be used to understand each parties contribution to achieving a parliament with a record number of women. 

The Green Party has one MP, who is female. The SDLP, Lib Dems, and Labour are close to having an equal number of male and female MPs. The DUP has the worst proportion of female MPs. The Speaker and the Alliance party, only have one MP who in both cases is male. The other parties range from 25% to 35%. 

It is clear that more needs to be done to achieve a parliament that is representative, this includes putting representative candidates up for election, and in seats that they have a chance at winning or at least securing a reasonable portion of the vote. The next question goes further into this.

```{r question_3_plot}
question_3_df %>% 
  ggplot(
    mapping = aes(
      y = party_name,
      x = prop_mps,
      size = `Total Party MPs`,
      colour = party_name,
    )
  ) +
  geom_point() + 
  scale_colour_manual(
    values = party_colours,
    labels = party_names,
    breaks = party_names,
    name = "Party",
    guide = FALSE
  ) +
  scale_x_continuous(
    labels = percent_format(accuracy = 1),
    n.breaks = 10,
  ) +
  scale_size_continuous(
    range = c(3,15),
    breaks = c(1, 5, 50, 100, 200, 300, 350)
  ) +
  labs(y = "Party", x = "Proportion of Female MPs") +
  geom_vline(xintercept = 0.5, size = 0.5, linetype = "dashed")
```

## Question 4: For each main party, how does the proportion of female candidates standing compare with the proportion of (total party) votes those female candidates received?

```{r question_4_analysis}
question_4_df <- cand_results_19 %>% 
  group_by(party_name) %>% 
  mutate(
    total_party_candidates = n(),
    total_party_votes = sum(votes)
  ) %>% 
  filter(gender == "Female") %>% 
  group_by(gender, .add = TRUE) %>% 
  summarise(
    female_cand_prop = n() / total_party_candidates,
    female_vote_prop = sum(votes) / total_party_votes
  ) %>% 
  distinct()
```

As mentioned in the previous question, to improve the number of Female MPs, parties need to stand more female candidates and in seats where they will share a substantial proportion of the vote to have a good chance of becoming an MP.

The plot below shows us how parties are doing to meet that goal. The closer parties are to the top right, the better they are doing. The closer parties are to the diagonal line, the more balanced between vote share and proportion of female candidates the parties are. 

We can see the Labour and Alliance have achieved a balanced vote and candidate mix, with the best gender representation of all the parties. The Green Party and SDLP are close; however, the SDLP have a majority of women but a noticeable minority of votes for women.  

The other parties are balanced in their votes and proportion of candidates, most clustered around the 25%-35% area (this roughly reflects the number of Female MPs).

The worst parties are the DUP and the Brexit Party. Other smaller parties also performed poorly with a relatively small proportion of votes going to the small proportion of women that stood for those parties.

```{r question_4_plot}
question_4_df %>% 
  ggplot(
    mapping = aes(
      x = female_cand_prop,
      y = female_vote_prop,
      colour = party_name,
      label = party_name
    )
  ) +
  geom_vline(xintercept = 0.50, size = 0.5, linetype = "dashed") +
  geom_hline(yintercept = 0.50, size = 0.5, linetype = "dashed") +
  geom_abline(slope = 1, intercept = 0, size = 0.5, linetype = "dashed") + 
  geom_point(
    size = 2,
    shape = 3,
    stroke = 1.5
  ) +
  party_colour_scale +
  labs(x = "Proportion of Female Candidates", y = "Female Vote Share") +
  scale_x_continuous(
    labels = percent_format(accuracy = 1),
    limits = c(0, 0.60)
  ) +
  scale_y_continuous(
    labels = percent_format(),
    limits = c(0, 0.6)
  ) + 
  geom_text_repel(
    box.padding = 1,
    force = 5
  )
```

## Question 5: For candidates from the main parties, win or lose, do incumbent MPs receive more votes on average than non-incumbent challengers?

```{r question_5_analysis}
# question_5_df <- cand_results_19 %>% 
#   filter(party_name != "Other") %>% 
#   group_by(won, sitting_mp) %>% 
#   summarise(
#     total_candidates = n(),
#     average_share = mean(share),
#     sd_share = sd(share)
question_5_df <- cand_results_19 %>% 
  filter(party_name != "Other") %>% 
  group_by(won, sitting_mp) %>%
  select(won, sitting_mp, share) %>% 
  mutate(
    won = case_when(
      won ~ "Won Election",
      TRUE ~ "Lost Election"
    ), 
    sitting_mp = case_when(
      sitting_mp ~ "Incumbant",
      TRUE ~ "Challenger"
    )
  )
```

In this last graph, it is clear that win or lose, an incumbent MP secured more votes than a challenger. This margin is much more pronounced when the candidate lost their election; however, the challenger data set include all less serious contenders such as minor party members, fridge/joke parties, and independents. 

```{r question_5_plot}
question_5_df %>% 
  ggplot(
    mapping = aes(
      x = sitting_mp,
      y = share,
      colour = won
    )
  ) +
  geom_boxplot() +
  facet_wrap(facets = vars(won)) +
  scale_y_continuous(
    name = "Share of the vote",
    labels = percent_format(accuracy = 1),
    breaks = seq(from = 0, to = 1, by = 0.1),
    minor_breaks = seq(from = 0, to = 1, by = 0.05)
  ) +
  scale_x_discrete(
    name = "Candidate Type"
  )+ 
  scale_colour_discrete() +
  theme(legend.position = "none")
```

# Conclusion

In summary, we found in this report:

  * Many parties are under-represented in the four countries of the UK with one or two parties taking an over-representative share of the seats.
  * Counties range in representation with the worst represented country being Gwynedd and the best Lincolnshire.
  * The majority of parties have less than half of MPs identify as female, with the SLDP, Labour, Liberal Democrats and the Greens having at least half MPs be female.
  * Labour, SDLP, Alliance, and the Green Party are the best at putting an equal number of female candidates as men, and putting them in elections where they secure half the votes for the party overall. The DUP, Brexit and "Other" parties are the worst at this.
  * Incumbent MPs, win or lose, secure more votes on average than challengers. 
  
One further question, that could be asked of this data set looking at the best and worst represented consistencies (rather than counties). This could be mapped on a map of the UK to provide a clear visual.

Beyond this, further investigation could involve increasing the size of the data set to include more information about the consistencies (from the Results by Consistency CSV that was also released with the Library Commons report) which includes variables such as turnout and party swings. Other data that could be added is more information about the candidates, such as sexuality, BAME status, Net Worth, Degree Status (what level, from where, and in what), as well as other variables that could be used to understand who seeks these high levels of power and responsibility. 

