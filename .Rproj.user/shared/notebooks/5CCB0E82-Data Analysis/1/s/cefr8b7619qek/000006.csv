"0","grants_x_subjects <- datasets$grants %>% "
"0","  left_join(datasets$subject_weight, by = ""grant_ref"") %>% "
"0","  left_join(datasets$subjects, by = ""subject_id"") %>% "
"0","  select("
"0","    grant_ref,"
"0","    subject,"
"0","    percentage,"
"0","    award_value"
"0","  ) %>% "
"0","  replace_na("
"0","    replace = list("
"0","      percentage = 100"
"0","    )"
"0","  ) %>% "
"0","  mutate("
"0","    percentage = percentage/100,"
"0","    weighted_award_value = percentage * award_value"
"0","  )"
"0",""
"0",""
"0","grants_x_subjects_summary <- grants_x_subjects %>% "
"0","  group_by(subject) %>% "
"0","  summarise("
"0","    total_weighted_award_value = sum(weighted_award_value),"
"0","    mean_percentage = mean(percentage),"
"0","    mean_weighted_award_value = mean(weighted_award_value),"
"0","    total_number_of_grants = n()"
"0","  )"
"0",""
"0","grants_x_subjects_summary"
