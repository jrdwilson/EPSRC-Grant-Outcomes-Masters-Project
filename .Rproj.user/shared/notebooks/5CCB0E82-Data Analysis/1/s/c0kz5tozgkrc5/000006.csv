"0","grants_x_topics <- datasets$grants %>% "
"0","  left_join(datasets$topic_weight, by = ""grant_ref"") %>% "
"0","  left_join(datasets$topics, by = ""topic_id"") %>% "
"0","  select("
"0","    grant_ref,"
"0","    topic,"
"0","    percentage,"
"0","    award_value"
"0","  ) %>% "
"0","  replace_na("
"0","    replace = list("
"0","      topic = ""Unclassified"","
"0","      percentage = 100"
"0","    )"
"0","  ) %>% "
"0","  mutate("
"0","    percentage = percentage/100,"
"0","    weighted_award_value = percentage * award_value"
"0","  )"
"0",""
"0",""
"0","grants_x_topics_summary <- grants_x_topics %>% "
"0","  group_by(topic) %>% "
"0","  summarise("
"0","    total_weighted_award_value = sum(weighted_award_value),"
"0","    mean_percentage = mean(percentage),"
"0","    mean_weighted_award_value = mean(weighted_award_value),"
"0","    total_number_of_grants = n()"
"0","  )"
"0",""
"0","grants_x_topics_summary"
