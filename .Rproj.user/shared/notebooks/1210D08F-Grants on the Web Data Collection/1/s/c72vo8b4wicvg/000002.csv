"0","# dataframes <- list("
"0","#   panel_details_df = tibble(),"
"0","#   panel_members_df = tibble(),"
"0","#   funded_type1_bynum_df = tibble(),"
"0","#   funded_type1_byvalue_df = tibble(),"
"0","#   outlines_bynum_df = tibble(),"
"0","#   outline_byvalue_df = tibble(),"
"0","#   deferred_fellowships_grants_df = tibble(),"
"0","#   approved_fellowships_grants_df = tibble(),"
"0","#   sift_grants_bynum_df = tibble(),"
"0","#   sift_grants_byvalue_df = tibble(),"
"0","#   funded_type2_bynum_df = tibble(),"
"0","#   funded_type2_byvalue_df = tibble(),"
"0","#   panel_rank_links_df = tibble()"
"0","# )"
"0","# "
"0","# error_panel_links <- c()"
"0",""
"0","sweet_get_panel_data <- function(link, dataframes = dataframes, log_on = TRUE, errors = c()){"
"0","  # wrapped function for collecting data from panel"
"0","  # get panel html"
"0","  panel <- get_html(link)"
"0","  "
"0","  # extract general panel details"
"0","  # general content: panel id - from link"
"0","  panel_id <- str_match(link,""PanelId=(.*)"")[2]"
"0","  "
"0","  # general content: panel name (#lblPanelName) - from html"
"0","  panel_name <- panel$html %>% html_element(""#lblPanelName"") %>% html_text()"
"0","  "
"0","  # general content: panel date (#lblDateOfPanel) - from html"
"0","  panel_date <- panel$html %>% html_element(""#lblDateOfPanel"") %>% html_text()"
"0","  "
"0","  # general content: panel contact (#lblPanelContact) - from html"
"0","  panel_contact <- panel$html %>% html_element(""#lblPanelContact"") %>% html_text()"
"0","  "
"0","  # general content: panel page type - from link"
"0","  panel_type <- paste(str_match(link,""([A-Z]*)View(.*?).aspx?"")[2:3], collapse = '')"
"0","  "
"0","  panel_details <- tibble("
"0","    panel_id = panel_id,"
"0","    panel_name = panel_name,"
"0","    panel_date = panel_date,"
"0","    panel_contact = panel_contact,"
"0","    panel_type = panel_type,"
"0","  )"
"0","  "
"0","  if (log_on) {"
"0","    log_print("
"0","      str_glue(""Successfully extracted panel details""), "
"0","      console = FALSE, "
"0","      hide_notes = TRUE"
"0","    )"
"0","  }"
"0","  "
"0","  dataframes$panel_details_df <- log_bind_row(dataframes$panel_details_df, panel_details, log_on = log_on)"
"0","  "
"0","  # extract tables"
"0","  #dgDetails"
"0","  panel_members <- panel$html %>% "
"0","    extract_table(""#dgDetails"", head_row = FALSE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$panel_members_df <- log_bind_row(dataframes$panel_members_df, panel_members, log_on = log_on)"
"0","  "
"0","  #dgFullByNum"
"0","  funded_type1_bynum <- panel$html %>% "
"0","    extract_table(""#dgFullByNum"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$funded_type1_bynum_df <- log_bind_row(dataframes$funded_type1_bynum_df, funded_type1_bynum, log_on = log_on)"
"0",""
"0","  #dgFullByValue"
"0","  funded_type1_byvalue <- panel$html %>% "
"0","    extract_table(""#dgFullByValue"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","    "
"0","  dataframes$funded_type1_byvalue_df <- log_bind_row(dataframes$funded_type1_byvalue_df, funded_type1_byvalue, log_on = log_on)"
"0","  "
"0","  #dgOutlineByNumber"
"0","  outlines_bynum <- panel$html %>% "
"0","    extract_table(""#dgOutlineByNumber"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$outlines_bynum_df <- log_bind_row(dataframes$outlines_bynum_df, outlines_bynum, log_on = log_on)"
"0","  "
"0","  #dgOutlineByValue"
"0","  outline_byvalue <- panel$html %>% "
"0","    extract_table(""#dgOutlineByValue"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$outline_byvalue_df <- log_bind_row(dataframes$outline_byvalue_df, outline_byvalue, log_on = log_on)"
"0","  "
"0","  #dgDeferredGrants span"
"0","  deferred_fellowships_grants <- panel$html %>% "
"0","    extract_elements(""#dgDeferredGrants span"", log_on = log_on) %>% "
"0","    tibble(grant_ref = .) %>% "
"0","    filter(grant_ref != """") %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$deferred_fellowships_grants_df <- log_bind_row(dataframes$deferred_fellowships_grants_df, deferred_fellowships_grants, log_on = log_on)"
"0","  "
"0","  #dgGrants"
"0","  approved_fellowships_grants <- panel$html %>% "
"0","    extract_table(""#dgGrants"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$approved_fellowships_grants_df <- log_bind_row(dataframes$approved_fellowships_grants_df, approved_fellowships_grants, log_on = log_on)"
"0","  "
"0","  #dgSiftByNum"
"0","  sift_grants_bynum <- panel$html %>% "
"0","    extract_table(""#dgSiftByNum"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$sift_grants_bynum_df <- log_bind_row(dataframes$sift_grants_bynum_df, sift_grants_bynum, log_on = log_on)"
"0","  "
"0","  #dgSiftByValue"
"0","  sift_grants_byvalue <- panel$html %>% "
"0","    extract_table(""#dgSiftByValue"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$sift_grants_byvalue_df <- log_bind_row(dataframes$sift_grants_byvalue_df, sift_grants_byvalue, log_on = log_on)"
"0","  "
"0","  #dgPanelByNum"
"0","  funded_type2_bynum <- panel$html %>% "
"0","    extract_table(""#dgPanelByNum"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$funded_type2_bynum_df <- log_bind_row(dataframes$funded_type2_bynum_df, funded_type2_bynum, log_on = log_on)"
"0","  "
"0","  #dgPanelByValue"
"0","  funded_type2_byvalue <- panel$html %>% "
"0","    extract_table(""#dgPanelByValue"", head_row = TRUE, log_on = log_on) %>% "
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$funded_type2_byvalue_df <- log_bind_row(dataframes$funded_type2_byvalue_df, funded_type2_byvalue, log_on = log_on)"
"0","  "
"0","    # pull links"
"0","  #pnlContent a"
"0","  panel_rank_links <-  panel$html %>% "
"0","    extract_elements(""#pnlContent a"", attr = ""href"", log_on = log_on) %>% "
"0","    tibble(href = .) %>% "
"0","#    filter(str_detect(href, ""NGBOViewPanelROL.aspx?"")) %>% # Commenting out to allow review of link incase this is not inclusive of all rank page links."
"0","    mutate(panel_id = panel_id, panel_type = panel_type)"
"0","  "
"0","  dataframes$panel_rank_links_df <- log_bind_row(dataframes$panel_rank_links_df, panel_rank_links, log_on = log_on)"
"0","  "
"0","  # output the updated dataframes, the wait time, and the unchanged errors"
"0","  return("
"0","    list("
"0","      dataframes = dataframes,"
"0","      wait = panel$wait,"
"0","      errors = errors"
"0","    )"
"0","  )"
"0","}"
