"0","# https://gow.epsrc.ukri.org/NGBOListThemeDrillDown.aspx?CapabilityTheme=Engineering&ItemId=Engineering"
"0",""
"0","for (theme_url in theme_href_list) {"
"0","  # first get the equivalent theme name"
"0","  theme_name <- theme_name_list[which(theme_href_list == theme_url)[1]]"
"0","  "
"0","  # is the theme a challenge theme or a capability theme"
"0","  theme_type <- ifelse(theme_name %in% challenge_themes, 'Challenge', 'Capability')"
"0","  "
"0","  # then get the html page for the theme"
"0","  start_time <- Sys.time()"
"0","  theme_content <- get_html(theme_url)$html"
"0","  end_time <- Sys.time()"
"0","  # work out duration for response for polite requesting"
"0","  theme_wait <- end_time - start_time"
"0","  "
"0","  # parse HTML for list of research area urls"
"0","  area_href_list <- theme_content %>%"
"0","    html_nodes(xpath = ""//td/a"") %>% "
"0","    html_attr(""href"")"
"0",""
"0","  # parse HTML for list of research area names"
"0","  area_name_list <- theme_content %>%"
"0","    html_nodes(xpath = ""//td/a"") %>% "
"0","    html_text()"
"0","  "
"0","  # wait for the response duration to be polite to the website"
"0","  Sys.sleep(theme_wait)"
"0","  "
"0","  for (area_url in area_href_list) {"
"0","    # first get the equivalent research area name"
"0","    area_name <- area_name_list[which(area_href_list == area_url)[1]]"
"0","    "
"0","    # get html content from website, timing the response time"
"0","    start_time <- Sys.time()"
"0","    area_content <- get_html(area_url)$html"
"0","    end_time <- Sys.time()"
"0","    "
"0","    # calculate the response time"
"0","    area_wait <- end_time - start_time"
"0","    "
"0","    # only need to parse the links so we can later extract the grant reference number"
"0","    grant_ref_list <- area_content %>%"
"0","      html_nodes(xpath = ""//td/a"") %>% "
"0","      html_attr(""title"") %>% "
"0","      unique()"
"0","    "
"0","    for (grant_ref in grant_ref_list) {"
"0","      theme_df <- theme_df %>% "
"0","        add_row("
"0","            theme_name = theme_name,"
"0","            theme_type = theme_type,"
"0","            research_area = area_name,"
"0","            grant_ref = grant_ref"
"0","        )"
"0","      "
"0","    }"
"0","    "
"0","    Sys.sleep(area_wait)"
"0","  }"
"0","  "
"0","  "
"0","}"
"0",""
"0",""
