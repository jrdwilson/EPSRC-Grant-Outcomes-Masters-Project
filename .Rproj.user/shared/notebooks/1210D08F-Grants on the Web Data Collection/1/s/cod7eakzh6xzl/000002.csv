"0","sweet_get_ranked_list <- function(link, dataframes = dataframes, log_on = TRUE, errors = c()){"
"0","  "
"0","  panel_id <- str_match(link,""PanelId=(.*)&"")[2]"
"0","  "
"0","  list_id <- str_match(link, ""ListId=(.*)"")[2]"
"0","  "
"0","  html <- get_html(link)$html"
"0","  "
"0","  "
"0","  grants <- extract_table(html, ""#dgGrants"", head_row = TRUE, log_on = log_on) %>% "
"0","      mutate(panel_id = panel_id, list_id = list_id)"
"0","  "
"0","  dataframes$panel_ranked_grants_df$grants <- dataframes$panel_ranked_grants_df$grants %>% "
"0","    log_bind_row(grants, log_on = log_on)"
"0","  "
"0","  # If there is a grants table and a deferred grant table, the deferred grants "
"0","  # table will have no head"
"0","  if (dim(grants)[1] > 0) {"
"0","    headless_deferred_grants <- html %>% "
"0","      extract_table(""#dgDeferredGrants"", head_row = FALSE, log_on = log_on) %>%"
"0","      mutate(panel_id = panel_id, list_id = list_id)"
"0","  "
"0","    dataframes$panel_ranked_grants_df$headless_defered_grants <- dataframes$panel_ranked_grants_df$headless_defered_grants %>%"
"0","        log_bind_row(headless_deferred_grants, log_on = log_on)"
"0","    "
"0","  } else {"
"0","    deferred_grants <- html %>% "
"0","      extract_table(""#dgDeferredGrants"", head_row = TRUE, log_on = log_on) %>% "
"0","      mutate(panel_id = panel_id, list_id = list_id)"
"0","    "
"0","    dataframes$panel_ranked_grants_df$defered_grants <- dataframes$panel_ranked_grants_df$defered_grants %>% "
"0","      log_bind_row(deferred_grants, log_on = log_on)"
"0","    "
"0","  }"
"0","  "
"0","  "
"0","  # Quickly view pages for CSS selector review"
"0","  # browseURL(paste(""https://gow.epsrc.ukri.org/"", link,sep = ''))"
"0","  "
"0","  "
"0","  # output the updated dataframes, the wait time, and the unchanged errors"
"0","  return("
"0","    list("
"0","      dataframes = dataframes,"
"0","      wait = panel$wait,"
"0","      errors = errors"
"0","    )"
"0","  )"
"0","}"
