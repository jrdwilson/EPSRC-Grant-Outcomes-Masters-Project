"0","# Set to true when needed but should be kept false otherwise to protect usage of API licience"
"0","RUN_GENDER_COLLECTION <- FALSE"
"0",""
"0","if (RUN_GENDER_COLLECTION) {"
"0","  split_names <- split(first_names$name, ceiling(seq_along(first_names$first_name)/10))"
"0","  "
"0","  bar_len <- length(split_names)"
"0","  pb <- init_bar(bar_len)"
"0","  "
"0","  # Open log"
"0","  lf <- log_open(paste0(""../logs/gtr"", format(Sys.time(), ""%Y%m%d_%H%M%S_""), ""gender_data_collection.log""), logdir = FALSE)"
"0","  "
"0","  # Declare the API key being using. If not using one, use NULL"
"0","  APIKEY <- ""b6540033b7bc0da7ac0748d7f23cc0be"""
"0","  "
"0","  # Start up logging"
"0","  # Collecting gender data from Genderize.io using the API key: {APIKEY}"
"0","  log_print("
"0","    str_glue(""Collecting gender data from Genderize.io using the API key: {APIKEY}""),"
"0","    console = FALSE,"
"0","    hide_notes = TRUE"
"0","  )"
"0","  "
"0","  gender_data <- tibble()"
"0","  "
"0","  for (names_batch in split_names) {"
"0","    # send API request"
"0","    genderAPI <- genderizeAPI("
"0","      names_batch,"
"0","      apikey = APIKEY"
"0","    )"
"0","    "
"0","    # Add to gender_data tibble"
"0","    gender_data <- gender_data %>% bind_rows(genderAPI$response)"
"0","    "
"0","    # Log message:"
"0","    # Collected gender data successfully. API requests remaining: {genderAPI$limitLeft}"
"0","    log_print(""Collected gender data successfully."", console = FALSE, hide_notes = TRUE)"
"0","    log_print(names_batch, console = FALSE, hide_notes = TRUE)"
"0","    log_print(str_glue(""API requests remaining: {genderAPI$limitLeft}""), console = FALSE, hide_notes = TRUE)"
"0","    "
"0","    # Update progress bar"
"0","    if (exists('pb')){"
"0","      if (!pb$finished) {"
"0","      pb$tick()"
"0","      }"
"0","    }"
"0","  }"
"0","  "
"0","  # Save gender_data"
"0","  file_dest <-  ""../data/gender_prediction/gender_data.csv"""
"0","  gender_data %>% write_csv(file_dest)"
"0","  # Log save"
"0","  log_print("
"0","    str_glue(""Saved gender data to: {file_dest}""),"
"0","    console = FALSE,"
"0","    hide_notes = TRUE"
"0","  )"
"0","  "
"0","  # Close log"
"0","  log_close()"
"0","  "
"0","  # View Results"
"0","  gender_data"
"0","}"
